/*!
 * CompareProducts v0.4.0
 * Vladimir Ivanin
 * 2017
 */
(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
function add(e,o){var t={item:e};o&&(t.button=o),Compare.add(t)}function remove(e,o){var t={item:e};o&&(t.button=o),Compare.remove(t)}function update(){Compare.update()}function getCompare(){return Compare.getCompare()}function getCompareIds(){for(var e=[],o=Compare.getCompare(),t=0;t<o.products.length;t++)e.push(o.products[t].id);return e}module.exports={add:add,remove:remove,update:update,getCompareIds:getCompareIds,getCompare:getCompare};
},{}],2:[function(require,module,exports){
function binding(){var e=this;bindAdd(e),bindRemove(e),bindTrigger(e)}function bindRemove(e){var t=getDataAttrName(e.options.selectors.remove);$(document).on("click",t,function(t){t.preventDefault(),e.productIds=e.api.getCompareIds();var d=$(this).data(e.options.selectors.remove),s=getStatusProduct($(this),e.productIds,d,e.options.classes.added,e.options.classes.notAdded);if(s.isActive||!s.notAdded){var o=render.getAllSelectors(e.options,[d]);e.api.remove(d,o.added)}})}function bindAdd(e){var t=getDataAttrName(e.options.selectors.add);$(document).on("click",t,function(t){t.preventDefault(),e.productIds=e.api.getCompareIds();var d=e.api.getCompare(),s=$(this).data(e.options.selectors.add),o=getStatusProduct($(this),e.productIds,s,e.options.classes.added,e.options.classes.notAdded);if(!(o.isActive&&o.isAdded||e.productIds.length>d.maxItems)){var r=render.getAllSelectors(e.options,[s]);e.api.add(s,r.added)}})}function bindTrigger(e){var t=getDataAttrName(e.options.selectors.trigger);$(document).on("click",t,function(t){t.preventDefault();var d=e.api.getCompare();e.productIds=e.api.getCompareIds();var s=$(this).data(e.options.selectors.trigger);if(getStatusProduct($(this),e.productIds,s,e.options.classes.added,e.options.classes.notAdded).isActive){o=render.getAllSelectors(e.options,[s]);e.api.remove(s,o.added)}else{if(e.productIds.length>d.maxItems)return;var o=render.getAllSelectors(e.options,[s]);e.api.add(s,o.added)}})}function getStatusProduct(e,t,d,s,o){return{isActive:t.indexOf(d)>-1,isAdded:e.hasClass(s),notAdded:e.hasClass(o)}}function getDataAttrName(e,t){return"[data-"+(t?e+'="'+t+'"':e)+"]"}var render=require("./render");module.exports=binding;
},{"./render":5}],3:[function(require,module,exports){
var defaults=require("../variables").defaults,system=require("../variables").system,init=require("./init"),api=require("./api"),binding=require("./binding"),CompareProducts=function(i){var e=this;return e.state={productIds:[]},e.options=$.extend(!0,{},defaults,i),e.api=api,e.init=init,e.binding=binding,EventBus?(e.init(),e.binding()):console.warn("Не подключен common.js"),e};module.exports=CompareProducts;
},{"../variables":7,"./api":1,"./binding":2,"./init":4}],4:[function(require,module,exports){
function init(){var e=this,n=e.options;EventBus.subscribe("update_items:insales:compares",function(r){render.update(r,n,e.api.getCompareIds()),n.onUpdate(r)}),EventBus.subscribe("init:insales:compares",function(r){render.update(r,n,e.api.getCompareIds()),n.onInit(r)}),EventBus.subscribe("overload:insales:compares",function(e){render.overload(e,n),n.onOverload(e)}),EventBus.subscribe("add_item:insales:compares",function(e){var r=e.action?e.action.button:null;r&&render.add(r,n),n.onAdd(e)}),EventBus.subscribe("remove_item:insales:compares",function(e){var r=e.action?e.action.button:null;r&&render.remove(r,n),n.onRemove(e)})}var render=require("./render");module.exports=init;
},{"./render":5}],5:[function(require,module,exports){
function add(e,t){e.addClass(t.classes.added).removeClass(t.classes.notAdded).removeClass(t.classes.disabled).removeAttr("disabled"),e.attr("title",t.titles.added),t.buttonAddedText&&e.text(t.buttonAddedText)}function remove(e,t){var a=$(getDataAttrName(t.selectors.add));e.addClass(t.classes.notAdded).removeClass(t.classes.added).removeClass(t.classes.disabled).removeAttr("disabled"),a.removeClass(t.classes.disabled).removeAttr("disabled"),e.attr("title",t.titles.notAdded),t.buttonNotAddedText&&e.text(t.buttonNotAddedText)}function update(e,t,a){var s=$(getDataAttrName(t.selectors.counter)),d=e.products.length,r=e.action.method;if(d&&d>0?s.html(t.counterTemplate.replace("%c%",d)).removeClass(t.classes.empty):t.counterTemplateEmpty?s.html(t.counterTemplateEmpty.replace("%c%",d)).addClass(t.classes.empty):s.html(t.counterTemplate.replace("%c%",d)).addClass(t.classes.empty),"init"==r){var l=getAllSelectors(t,a),o=l.removed,c=l.added;d&&d>0&&add(c,t),remove(o,t)}}function getAllSelectors(e,t){var a=[],s=[];s.push(getDataAttrName(e.selectors.add)),s.push(getDataAttrName(e.selectors.remove)),s.push(getDataAttrName(e.selectors.trigger));for(var d=0;d<t.length;d++)a.push(getDataAttrName(e.selectors.add,t[d])),a.push(getDataAttrName(e.selectors.remove,t[d])),a.push(getDataAttrName(e.selectors.trigger,t[d]));var r=a.join(",");return{added:$(r),removed:$(s.join(",")).not(r)}}function overload(e,t){$(getDataAttrName(t.selectors.add)).addClass(t.classes.disabled).removeAttr("disabled")}function getDataAttrName(e,t){return"[data-"+(t?e+'="'+t+'"':e)+"]"}module.exports={add:add,remove:remove,update:update,getAllSelectors:getAllSelectors,overload:overload};
},{}],6:[function(require,module,exports){
window.CompareProducts=require("CompareProducts");
},{"CompareProducts":3}],7:[function(require,module,exports){
var defaults={selectors:{add:"compares-add",remove:"compares-remove",trigger:"compares-trigger",counter:"compares-counter"},counterTemplate:"(%c%)",counterTemplateEmpty:null,buttonNotAddedText:null,buttonAddedText:null,titles:{added:"Добавлен в сранение",notAdded:"Добавить в сранение"},classes:{added:"is-added",notAdded:"not-added",empty:"is-empty",disabled:"is-disabled"},onAdd:function(){},onRemove:function(){},onUpdate:function(){},onInit:function(){},onOverload:function(){}},system={};module.exports={defaults:defaults,system:system};
},{}]},{},[6]);
